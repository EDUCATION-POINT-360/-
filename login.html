<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Education Point | Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
    body {
      background: linear-gradient(135deg, #000, #111);
      color: #fff; min-height: 100vh;
      display: flex; justify-content: center; align-items: center;
      padding: 20px; overflow-x: hidden;
    }
    .container {
      width: 100%; max-width: 480px;
      background: rgba(255,255,255,0.05);
      padding: 30px; border-radius: 20px;
      box-shadow: 0 0 25px rgba(255,255,255,0.1);
      backdrop-filter: blur(12px);
      z-index: 1; position: relative;
    }
    h2 { text-align: center; margin-bottom: 20px; font-weight: 600; }
    input, select {
      width: 100%; padding: 12px; margin: 8px 0;
      border: none; border-radius: 10px;
      background: rgba(255,255,255,0.1); color: #fff;
    }
    button {
      width: 100%; padding: 12px; margin: 10px 0;
      background: #fff; color: #000;
      border-radius: 10px; cursor: pointer;
    }
    .link-btn {
      background: none; border: none; color: #aaa;
      text-decoration: underline; cursor: pointer;
      font-size: 14px; display: inline-block;
    }
    .dashboard { display: none; }
    .profile-pic { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 2px solid #fff; }
    #banner {
      position: fixed; top: 15px; left: 50%;
      transform: translateX(-50%);
      background: #4caf50; color: #fff;
      padding: 12px 25px; border-radius: 8px;
      display: none; z-index: 999;
    }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { border: 1px solid #fff; padding: 8px; text-align: center; }
    th { background: rgba(255,255,255,0.2); }
  </style>
</head>
<body>

<div id="banner"></div>

<!-- Login/Register Section -->
<div class="container" id="auth-section">
  <h2 id="form-title"><i class="fas fa-user-plus"></i> Register</h2>
  <input type="text" id="name" placeholder="Full Name" />
  <input type="email" id="email" placeholder="Email" />
  <input type="password" id="password" placeholder="Password" />
  <select id="class">
    <option value="">Select Class</option>
    <option>9th</option><option>10th</option><option>11th</option><option>12th</option>
  </select>
  <select id="city">  
    <option value="">Select City</option>  
    <option>Lahore</option><option>Faisalabad</option><option>Rawalpindi</option><option>Multan</option>
    <option>Other City</option>  
  </select>
  <input type="file" id="profile-pic" accept="image/*" />
  <button onclick="register()">Register</button>
  <button class="link-btn" onclick="switchToLogin()">Already have an account? Login</button>
</div>

<!-- Student Dashboard -->
<div class="container dashboard" id="student-dashboard">
  <h2>Student Dashboard</h2>
  <img id="studentPic" class="profile-pic" src="" alt="Profile" />
  <p><strong>Name:</strong> <span id="studentName"></span></p>
  <p><strong>Email:</strong> <span id="studentEmail"></span></p>
  <p><strong>Class:</strong> <span id="studentClass"></span></p>
  <p><strong>City:</strong> <span id="studentCity"></span></p>
  <button onclick="logout()">Logout</button>
</div>

<!-- Admin Dashboard -->
<div class="container dashboard" id="admin-dashboard">
  <h2>Admin Dashboard</h2>
  <table>
    <thead>
      <tr><th>Name</th><th>Email</th><th>Class</th><th>City</th><th>Profile</th></tr>
    </thead>
    <tbody id="usersTable"></tbody>
  </table>
  <button onclick="logout()">Logout</button>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, updateProfile } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-storage.js";

  const firebaseConfig = {
    apiKey: "AIzaSyARB13uvGaN0kiylXTp38iRKgD0KVboWOA",
    authDomain: "login-b1e2a.firebaseapp.com",
    projectId: "login-b1e2a",
    storageBucket: "login-b1e2a.appspot.com",
    messagingSenderId: "560940562071",
    appId: "1:560940562071:web:054aa0d82dda66b16a1bd2"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const storage = getStorage(app);

  async function register() {
    const name = document.getElementById("name").value.trim();
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value;
    const cls = document.getElementById("class").value;
    const city = document.getElementById("city").value;
    const pic = document.getElementById("profile-pic").files[0];

    if (!name || !email || !password || !cls || !city || !pic) {
      return showBanner("Please fill all fields.");
    }

    try {
      const userCredential = await createUserWithEmailAndPassword(auth, email, password);
      const user = userCredential.user;

      const storageRef = ref(storage, `profiles/${user.uid}.jpg`);
      await uploadBytes(storageRef, pic);
      const profileURL = await getDownloadURL(storageRef);

      await updateProfile(user, { displayName: name, photoURL: profileURL });

      await setDoc(doc(db, "users", user.uid), {
        name, email, cls, city, pic: profileURL, role: "student"
      });

      showBanner("Registered successfully. Please login.");
      switchToLogin();
    } catch (error) {
      showBanner(error.message);
    }
  }

  async function login() {
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value;

    try {
      const userCredential = await signInWithEmailAndPassword(auth, email, password);
      const user = userCredential.user;
      const docSnap = await getDoc(doc(db, "users", user.uid));
      const userData = docSnap.exists() ? docSnap.data() : {};

      document.getElementById("auth-section").style.display = "none";

      if (userData.role === "admin") {
        loadUsers();
        document.getElementById("admin-dashboard").style.display = "block";
      } else {
        document.getElementById("student-dashboard").style.display = "block";
        document.getElementById("studentName").innerText = userData.name;
        document.getElementById("studentEmail").innerText = user.email;
        document.getElementById("studentClass").innerText = userData.cls;
        document.getElementById("studentCity").innerText = userData.city;
        document.getElementById("studentPic").src = userData.pic;
      }
      showBanner("Login successful.");
    } catch (error) {
      showBanner("Invalid login credentials.");
    }
  }

  async function loadUsers() {
    const querySnap = await getDocs(collection(db, "users"));
    const table = document.getElementById("usersTable");
    table.innerHTML = "";
    querySnap.forEach(docSnap => {
      const u = docSnap.data();
      table.innerHTML += `
        <tr>
          <td>${u.name}</td>
          <td>${u.email}</td>
          <td>${u.cls}</td>
          <td>${u.city}</td>
          <td><img src="${u.pic}" width="40" height="40" style="border-radius:50%"></td>
        </tr>
      `;
    });
  }

  async function logout() {
    await signOut(auth);
    document.getElementById("student-dashboard").style.display = "none";
    document.getElementById("admin-dashboard").style.display = "none";
    document.getElementById("auth-section").style.display = "block";
    switchToRegister();
  }

  function switchToLogin() {
    document.getElementById("form-title").innerText = "Login";
    document.getElementById("name").style.display = "none";
    document.getElementById("class").style.display = "none";
    document.getElementById("city").style.display = "none";
    document.getElementById("profile-pic").style.display = "none";
    document.querySelector("button[onclick='register()']").innerText = "Login";
    document.querySelector("button[onclick='register()']").setAttribute("onclick", "login()");
  }

  function switchToRegister() {
    document.getElementById("form-title").innerText = "Register";
    document.getElementById("name").style.display = "block";
    document.getElementById("class").style.display = "block";
    document.getElementById("city").style.display = "block";
    document.getElementById("profile-pic").style.display = "block";
    document.querySelector("button[onclick='login()']").innerText = "Register";
    document.querySelector("button[onclick='login()']").setAttribute("onclick", "register()");
  }

  function showBanner(msg) {
    const banner = document.getElementById("banner");
    banner.innerText = msg;
    banner.style.display = "block";
    setTimeout(() => banner.style.display = "none", 3000);
  }

  window.register = register;
  window.login = login;
  window.logout = logout;
  window.switchToLogin = switchToLogin;
  window.switchToRegister = switchToRegister;
</script>

</body>
</html>
